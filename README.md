![image](https://user-images.githubusercontent.com/107175092/201665571-f87e0d09-bb46-42aa-9677-9269b5ea801f.png)

# Project Description

### Product Description
Cluster3 is the #1 source for Community Contributors. You can check the contribution score and ranking of 1000+ communities and one million contributors. Aggregating both on-chain and off-chain data, Cluster3 serves as community achievement system for contributors, enabling community contribution traceable and quantifiable among contributors and organizations.

We integrate on-chain data credentials and off-chain behavior data(e.g. POAP/OATs, ERC-20 token,Voting data, behavioral label data, etc.ï¼‰,and build a comprehensive user profile, to present externally in the form of dynamic nft, so that the project party can intuitively understand the users, allowing users to trace back their contributions.

### During this hackathon
- we implemented the key function of dynamic NFT based on the chainlink Any API:
Record the contribution score and ranking data generated by Cluster3 in IPFS, and use the chainlink Any API to dynamically update the IPFS storage address to the NFT contract, and issue it to users as proof of contribution.
- For the dynamic NFT display effect, we specially designed treasure chest images for different levels of users. According to the user's contribution ranking, users will see different styles of treasure chests,and different styles of treasure chests also have different animation effects.


### DemoðŸ”—ï¼šhttps://www.cluster3.club/
<br/>

# Usage
<!-- MarkdownTOC -->

- [How to get Cluster3 dynamic NFT?](#how-to-get-cluster3-dynamic-nft)
- [Principles of Updating Leaderboards](#principles-of-updating-leaderboards)
- [view leaderboard](#view-leaderboard)
- [View rankings and scores at Opensea](#view-rankings-and-scores-at-opensea)

<!-- /MarkdownTOC -->

<a id="how-to-get-cluster3-dynamic-nft"></a>
### How to get Cluster3 dynamic NFT?
1. How to get
    1. Click"connect" button,and connect your wallet
![image](https://user-images.githubusercontent.com/107175092/201665604-8daa6992-6168-4793-a682-bea51bb8c7f1.png)
    2. Enter Cluster3 personal center
![image](https://user-images.githubusercontent.com/107175092/201665647-2185dd4f-0e8a-4467-a2f7-18f12281a541.png)
    3. Click "Claim"
![image](https://user-images.githubusercontent.com/107175092/201665656-8ab66179-7109-4502-b2b2-7f3cb025659f.png)
    4. After confirming, click "continue"
![image](https://user-images.githubusercontent.com/107175092/201665726-5f4b8aca-269b-4bcd-8d9c-61dd6f99a38d.png)
    5. After confirming that the content in the ID card belongs to you,then click the "claim" button
![image](https://user-images.githubusercontent.com/107175092/201665767-a1c4d36b-6ede-4596-a6bc-72eee015c1d7.png)
    6. After the wallet account is authorized, you need to wait for about 30 seconds on the current page, your cluster3 dynamic nft will be sent to your wallet, and the claim button will be grayed out at this time
![image](https://user-images.githubusercontent.com/107175092/201665812-313b040b-9285-45d6-9f58-48edb37cbb05.png)
    7. After receiving it successfully, your personal center page will change to the information shown in the figure below
![image](https://user-images.githubusercontent.com/107175092/201665789-2e80e80e-3dd1-4366-8b69-a5c2d6648a9e.png)

<a id="principles-of-updating-leaderboards"></a>
### Principles of Updating Leaderboards
1. At midnight every day, the system will calculate and update the ranking and rating data of all users of Cluster3
2. The details are as follows:
    1. First, the system will upload the ranking data and corresponding treasure chest pictures of users ï¼Œwho have minted NFT to "nft.storage", and then call the "updateRankUrlRequest" method of the contract.The contract will call the Cluster3 system through "ChainLink anyapi" to obtain the leaderboard file link stored by the system in "nft.storage", and then stored in rankUrl.
    ```solidity
    constructor() ERC1155("https://api.cluster3.club/openapi/token/{id}.json") payable {
            owner = msg.sender;
            setChainlinkToken(0x326C977E6efc84E512bB9C30f76E30c160eD06FB);
            setChainlinkOracle(0x40193c8518BB267228Fc409a613bDbD8eC5a97b3);
            jobId = '7da2702f37fd48e5b1b9a5715e3509b6';
            fee = (1 * LINK_DIVISIBILITY) / 10;
            // 0,1 * 10**18 (Varies by network and job)
        }
    ```
    2. When the contract is minted, specify the use of "ChainLink Oracleï¼ŒLink Token Addressï¼ŒOracle Job Id"ï¼Œused to initialize the ChainLink usage environment.The contract minting uses "Polygon Mumbai (testnet) Oracle, GET>bytes Job, Polygon Mumbai (testnet) Link Token".
    ```solidity
    function updateRankUrlRequest() public onlyOwner {
            Chainlink.Request memory req = buildChainlinkRequest(jobId, address(this), this.fulfill.selector);
            req.add(
                'get',
                'https://api.cluster3.club/openapi/token/rankUrl'
            );
            req.add('path', 'data');
            sendChainlinkRequest(req, (1 * LINK_DIVISIBILITY) / 10);
        }
    ```
    3. In the account permission part, through the "updateRankUrlRequest" method, only the owner (contract creator) can be called.When calling, specify the "jobId, any api" to call the external api address and the type of the request method. Then send the request to "any api".
    ```solidity
    bytes public data;
        /**
         * Receive the response in the form of bytes32
         */
        function fulfill(bytes32 requestId, bytes memory bytesData) public recordChainlinkFulfillment(requestId) {
            emit GetResponse(requestId, bytesData);
            data = bytesData;
            rankUrl = string(data);
        }
    ```
            After any api receives the request, the "ChainLink Oracle" public service provider will analyze the response (analysis will be performed according to the path set by the request), and then call back the fulfill method in the contract to update the leaderboard.
            
<a id="view-leaderboard"></a>
### view leaderboard
1. The cluster3 system will actively trigger the update data, and the contract calls the system through any api to obtain the latest "nft.storage" file address, which is stored in the corresponding field of the contract
2. If the user needs to query their own ranking and rating data, the holder can query through the uri method of the contract with their own token id. The specific example is as follows
Example of file content:
    ```json
    [
            {
            "score": 1056,
            "rank": 1735,
            "address": "https://img2.cluster3.club/chainlink/box3.gif"
        },
        {
            "score": 0,
            "rank": 2802,
            "address": "https://img2.cluster3.club/chainlink/box2.gif"
        },
        {
            "score": 4022,
            "rank": 317,
            "address": "https://img2.cluster3.club/chainlink/box4.gif"
        }
    ]
    ```


<a id="view-rankings-and-scores-at-opensea"></a>
### View rankings and scores at Opensea
After casting the treasure chest, you can view the cluster3 treasure chest in Opensea
Opensea ðŸ”—ï¼šhttps://testnets.opensea.io/collection/cluster3-dynamic-nft-v2
The Rank score and ranking corresponding to each NFT can be seen in the properties section.

![image](https://user-images.githubusercontent.com/107175092/201666180-02d87ec8-2457-404b-bc8d-0e8088113473.png)

NFTs with different rankings display different treasure chest styles, and the hierarchical relationship is as follows:
1. R-level treasure chest: corresponding to users ranked after 2000 in user contribution
![image](https://user-images.githubusercontent.com/107175092/201666202-479b4064-de61-4ae0-bb51-84212d9ad9b2.png)
2. S-level treasure chest: Corresponding users whose contribution ranks from 1001 to 2000
![image](https://user-images.githubusercontent.com/107175092/201666222-3437bcfa-ac6d-42a8-9e86-d61119c57ffe.png)
3. SR-level treasure chest: Corresponding users whose contribution ranks from 101 to 1000
![image](https://user-images.githubusercontent.com/107175092/201666235-295a57d8-dde3-4bf7-912e-97980b981fde.png)
4. SSR-level treasure chest: Corresponding users whose contribution ranks from 1 to 100
![image](https://user-images.githubusercontent.com/107175092/201666251-e6e6cfcc-863f-4822-8f95-bd367edada40.png)
